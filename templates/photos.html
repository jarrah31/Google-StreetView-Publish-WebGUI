{% extends 'base.html' %}

{% block title %}Photos{% endblock %}

{% block content %}
<div class="container_photos">
    <div class="title-container">
        <h1>Photos</h1>
        <div class="view-toggle-container">
            <button id="list-view-btn" class="view-btn active" onclick="switchView('list')">List View</button>
            <button id="grid-view-btn" class="view-btn" onclick="switchView('grid')">Grid View</button>
        </div>
    </div>

    <div class="photo-container">
        <!-- Database Statistics -->
        <div class="details-grid">
            <div class="grid-label">Total Photos:</div>
            <div class="grid-value">{{ total_photos }}</div>
            
            <div class="grid-label">Places:</div>
            <div class="grid-value">{{ total_places }}</div>
            
            <div class="grid-label">Connections:</div>
            <div class="grid-value">{{ total_connections }}</div>
            
            <div class="grid-label">Last Updated:</div>
            <div class="grid-value">{{ last_updated }}</div>
        </div>
    </div>
    
    <!-- Sort Controls -->
    <div class="sort-controls" style="display: none; justify-content: flex-start;">
        <select id="sort-select" onchange="updateSort(this.value)">
            <option value="">Sort-by</option>
            <option value="maps_publish_status" {% if sort_by == 'maps_publish_status' %}selected{% endif %}>Status</option>
            <option value="view_count" {% if sort_by == 'view_count' %}selected{% endif %}>Views</option>
            <option value="capture_time" {% if sort_by == 'capture_time' %}selected{% endif %}>Capture Date</option>
            <option value="upload_time" {% if sort_by == 'upload_time' %}selected{% endif %}>Upload Date</option>
            <option value="place_names" {% if sort_by == 'place_names' %}selected{% endif %}>Places</option>
        </select>
        <a href="#" id="sort-direction-btn" onclick="toggleSortDirection(); return false;" class="page-link" data-sort-order="{{ sort_order }}">
            {% if sort_order == 'desc' %}Descending{% else %}Ascending{% endif %}
        </a>
    </div>
    
    <!-- Pagination Controls -->
    <div class="pagination-container">
        <div class="pagination-info">
            {% if per_page != 'all' %}
                Showing {{ ((page - 1) * per_page|int) + 1 }} to {{ [page * per_page|int, total_records]|min }} of {{ total_records }} records
            {% else %}
                Showing all {{ total_records }} records
            {% endif %}
        </div>
        <div class="pagination-controls">
            <div class="rows-per-page">
                <label for="per-page">Rows per page:</label>
                <select id="per-page" onchange="changeRowsPerPage(this.value)">
                    <option value="25" {% if per_page == '25' %}selected{% endif %}>25</option>
                    <option value="50" {% if per_page == '50' %}selected{% endif %}>50</option>
                    <option value="100" {% if per_page == '100' %}selected{% endif %}>100</option>
                    <option value="all" {% if per_page == 'all' %}selected{% endif %}>All</option>
                </select>
            </div>
            
            {% if per_page != 'all' and total_pages > 1 %}
            <div class="page-nav">
                <a href="{{ url_for('list_photos_table_page', page=1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page == 1 %}disabled{% endif %}">First</a>
                
                <a href="{{ url_for('list_photos_table_page', page=page-1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page == 1 %}disabled{% endif %}">Prev</a>
                
                <span class="page-indicator">Page {{ page }} of {{ total_pages }}</span>
                
                <a href="{{ url_for('list_photos_table_page', page=page+1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page >= total_pages %}disabled{% endif %}">Next</a>
                
                <a href="{{ url_for('list_photos_table_page', page=total_pages, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page >= total_pages %}disabled{% endif %}">Last</a>
            </div>
            {% endif %}
            
            {% if status_filter or places_filter or capture_date_from or capture_date_to or upload_date_from or upload_date_to %}
            <div class="clear-filters-container">
                <a href="{{ url_for('list_photos_table_page', page=1, per_page=per_page, sort_by=sort_by, sort_order=sort_order) }}" class="clear-filters-btn">Clear All Filters</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Photos Table View -->
    <div id="list-view" class="custom-table-container">
        <table class="photo-table">
            <thead>
                <tr>
                    <th>
                        <a href="{{ url_for('list_photos_table_page', sort_by='photo_id', sort_order='asc' if sort_by == 'photo_id' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Photo</a>
                    </th>
                    <th class="filterable-header">
                        <div class="header-content">
                            <a href="{{ url_for('list_photos_table_page', sort_by='maps_publish_status', sort_order='asc' if sort_by == 'maps_publish_status' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Status</a>
                            <button class="filter-toggle" onclick="toggleFilter('status-filter')"><i class="filter-icon">▼</i></button>
                        </div>
                        <form id="status-filter-form" action="{{ url_for('list_photos_table_page') }}" method="GET" class="filter-form">
                            <input type="hidden" name="sort_by" value="{{ sort_by }}">
                            <input type="hidden" name="sort_order" value="{{ sort_order }}">
                            <input type="hidden" name="per_page" value="{{ per_page }}">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" name="places_filter" value="{{ places_filter }}">
                            <input type="hidden" name="capture_date_from" value="{{ capture_date_from }}">
                            <input type="hidden" name="capture_date_to" value="{{ capture_date_to }}">
                            <input type="hidden" name="upload_date_from" value="{{ upload_date_from }}">
                            <input type="hidden" name="upload_date_to" value="{{ upload_date_to }}">
                            
                            <div id="status-filter" class="filter-dropdown">
                                <div class="filter-dropdown-content">
                                    <div class="filter-option">
                                        <label><input type="checkbox" name="status_filter" value="all" {% if not status_filter %}checked{% endif %}> All</label>
                                    </div>
                                    
                                    {% for status in status_values %}
                                    <div class="filter-option">
                                        <label><input type="checkbox" name="status_filter" value="{{ status }}" {% if status in status_filter %}checked{% endif %}> {{ status }}</label>
                                    </div>
                                    {% endfor %}
                                    <div class="filter-actions">
                                        <button type="submit">Apply</button>
                                        <button type="button" onclick="clearStatusFilter()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </th>
                    <th>
                        <a href="{{ url_for('list_photos_table_page', sort_by='view_count', sort_order='asc' if sort_by == 'view_count' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Views</a>
                    </th>
                    <th class="filterable-header">
                        <div class="header-content">
                            <a href="{{ url_for('list_photos_table_page', sort_by='capture_time', sort_order='asc' if sort_by == 'capture_time' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Capture Date</a>
                            <button class="filter-toggle" onclick="toggleFilter('capture-date-filter')"><i class="filter-icon">▼</i></button>
                        </div>
                        <form id="capture-date-filter-form" action="{{ url_for('list_photos_table_page') }}" method="GET" class="filter-form">
                            <input type="hidden" name="sort_by" value="{{ sort_by }}">
                            <input type="hidden" name="sort_order" value="{{ sort_order }}">
                            <input type="hidden" name="per_page" value="{{ per_page }}">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" name="status_filter" value="{{ status_filter }}">
                            <input type="hidden" name="places_filter" value="{{ places_filter }}">
                            <input type="hidden" name="upload_date_from" value="{{ upload_date_from }}">
                            <input type="hidden" name="upload_date_to" value="{{ upload_date_to }}">
                            
                            <div id="capture-date-filter" class="filter-dropdown">
                                <div class="filter-dropdown-content date-filter">
                                    <div class="date-range">
                                        <label>From:
                                            <input type="month" name="capture_date_from" value="{{ capture_date_from }}">
                                        </label>
                                        <label>To:
                                            <input type="month" name="capture_date_to" value="{{ capture_date_to }}">
                                        </label>
                                    </div>
                                    <div class="filter-actions">
                                        <button type="submit">Apply</button>
                                        <button type="button" onclick="clearCaptureDateFilter()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </th>
                    <th class="filterable-header">
                        <div class="header-content">
                            <a href="{{ url_for('list_photos_table_page', sort_by='upload_time', sort_order='asc' if sort_by == 'upload_time' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Upload Date</a>
                            <button class="filter-toggle" onclick="toggleFilter('upload-date-filter')"><i class="filter-icon">▼</i></button>
                        </div>
                        <form id="upload-date-filter-form" action="{{ url_for('list_photos_table_page') }}" method="GET" class="filter-form">
                            <input type="hidden" name="sort_by" value="{{ sort_by }}">
                            <input type="hidden" name="sort_order" value="{{ sort_order }}">
                            <input type="hidden" name="per_page" value="{{ per_page }}">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" name="status_filter" value="{{ status_filter }}">
                            <input type="hidden" name="places_filter" value="{{ places_filter }}">
                            <input type="hidden" name="capture_date_from" value="{{ capture_date_from }}">
                            <input type="hidden" name="capture_date_to" value="{{ capture_date_to }}">
                            <input type="hidden" name="upload_date_from" value="{{ upload_date_from }}">
                            <input type="hidden" name="upload_date_to" value="{{ upload_date_to }}">
                            
                            <div id="upload-date-filter" class="filter-dropdown">
                                <div class="filter-dropdown-content date-filter">
                                    <div class="date-range">
                                        <label>From:
                                            <input type="month" name="upload_date_from" value="{{ upload_date_from }}">
                                        </label>
                                        <label>To:
                                            <input type="month" name="upload_date_to" value="{{ upload_date_to }}">
                                        </label>
                                    </div>
                                    <div class="filter-actions">
                                        <button type="submit">Apply</button>
                                        <button type="button" onclick="clearUploadDateFilter()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </th>
                    <th class="filterable-header">
                        <div class="header-content">
                            <a href="{{ url_for('list_photos_table_page', sort_by='place_names', sort_order='asc' if sort_by == 'place_names' and sort_order == 'desc' else 'desc', per_page=per_page, page=page, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}">Places</a>
                            <button class="filter-toggle" onclick="toggleFilter('places-filter')"><i class="filter-icon search-icon">🔍</i></button>
                        </div>
                        <form id="places-filter-form" action="{{ url_for('list_photos_table_page') }}" method="GET" class="filter-form">
                            <input type="hidden" name="sort_by" value="{{ sort_by }}">
                            <input type="hidden" name="sort_order" value="{{ sort_order }}">
                            <input type="hidden" name="per_page" value="{{ per_page }}">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" name="status_filter" value="{{ status_filter }}">
                            <input type="hidden" name="capture_date_from" value="{{ capture_date_from }}">
                            <input type="hidden" name="capture_date_to" value="{{ capture_date_to }}">
                            <input type="hidden" name="upload_date_from" value="{{ upload_date_from }}">
                            <input type="hidden" name="upload_date_to" value="{{ upload_date_to }}">
                            
                            <div id="places-filter" class="filter-dropdown">
                                <div class="filter-dropdown-content">
                                    <div class="search-filter">
                                        <input type="text" name="places_filter" id="places-search" placeholder="Search places..." value="{{ places_filter }}">
                                    </div>
                                    <div class="filter-actions">
                                        <button type="submit">Apply</button>
                                        <button type="button" onclick="clearPlacesFilter()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </th>
                    <th>Connections</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="photo-table-body">
                {% for photo in photos %}
                <tr class="photo-row">
                    <td>
                        <a href="{{ photo.share_link }}" target="_blank" title="View on Google Maps">
                            View
                        </a>
                    </td>
                    <td>
                        {% if photo.maps_publish_status %}
                            {{ photo.maps_publish_status }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ photo.view_count|default('0') }}</td>
                    <td>
                        {% if photo.capture_time %}
                            {{ photo.capture_time|replace("T00:00:00Z", "")|replace("T", " ")|replace("Z", "") }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        {% if photo.upload_time %}
                            {{ photo.upload_time.split("T")[0] }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        {% if photo.place_names %}
                            {{ photo.place_names }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ photo.connection_count }}</td>
                    <td>
                        <select class="action-select" onchange="if(this.value) window.location.href=this.value;">
                            <option value="">Select</option>
                            <option value="{{ url_for('edit_photo', photo_id=photo.photo_id) }}">Edit Photo</option>
                            <option value="{{ url_for('edit_connections', photo_id=photo.photo_id) }}">Edit Connections</option>
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Photos Grid View -->
    <div id="grid-view" class="main-container" style="display: none;">
        {% for photo in photos %}
            <div class="photo-container grid-item">
                <a href="{{ photo.share_link }}" target="_blank">
                    {% if photo.thumbnail_url %}
                        <img src="{{ photo.thumbnail_url }}" alt="Photo thumbnail" class="grid-thumbnail-image">
                    {% elif photo.photo_id %}
                        <img src="https://streetviewpublish.googleapis.com/v1/photos/{{ photo.photo_id }}:getDownloadUrl?key={{ api_key }}" alt="Photo thumbnail" class="grid-thumbnail-image">
                    {% else %}
                        <img src="{{ url_for('static', filename='icons8-panorama-96-favicon.png') }}" alt="No image available" class="grid-thumbnail-image">
                    {% endif %}
                </a>
                {% if photo.place_names %}
                    <p>Place: {{ photo.place_names }}</p>
                {% else %}
                    <p>Place: N/A</p>
                {% endif %}
                <p>Published Status: {{ photo.maps_publish_status|default('N/A') }}</p>
                <p>View count: {{ photo.view_count|default('0') }}</p>
                <p>Capture time: {{ photo.capture_time|replace("T00:00:00Z", "")|replace("T", " ")|replace("Z", "")|default('N/A') }}</p>
                <p>Upload time: {{ photo.upload_time.split("T")[0]|default('N/A') }}</p>
                <p>Connections: {{ photo.connection_count }}</p>
                <div class="button-container">
                    <a href="{{ url_for('edit_photo', photo_id=photo.photo_id) }}" class="grid-button">Edit Photo</a>
                    <a href="{{ url_for('edit_connections', photo_id=photo.photo_id) }}" class="grid-button">Edit Connections</a>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- Bottom Pagination Controls -->
    {% if per_page != 'all' and total_pages > 1 %}
    <div class="pagination-container bottom">
        <div class="pagination-controls">
            <div class="page-nav">
                <a href="{{ url_for('list_photos_table_page', page=1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page == 1 %}disabled{% endif %}">First</a>
                
                <a href="{{ url_for('list_photos_table_page', page=page-1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page == 1 %}disabled{% endif %}">Prev</a>
                
                <span class="page-indicator">Page {{ page }} of {{ total_pages }}</span>
                
                <a href="{{ url_for('list_photos_table_page', page=page+1, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page >= total_pages %}disabled{% endif %}">Next</a>
                
                <a href="{{ url_for('list_photos_table_page', page=total_pages, per_page=per_page, sort_by=sort_by, sort_order=sort_order, status_filter=status_filter, places_filter=places_filter, capture_date_from=capture_date_from, capture_date_to=capture_date_to, upload_date_from=upload_date_from, upload_date_to=upload_date_to) }}" class="page-link {% if page >= total_pages %}disabled{% endif %}">Last</a>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize the view based on local storage or default to list view
    document.addEventListener('DOMContentLoaded', function() {
        const selects = document.querySelectorAll('.action-select');
        selects.forEach(select => {
            select.value = '';
        });
        
        // Initialize filters
        initializeFilters();
        
        // Initialize view from localStorage or default to list view
        const currentView = localStorage.getItem('photoViewPreference') || 'list';
        switchView(currentView);
    });
    
    // Function to switch between list and grid views
    function switchView(viewType) {
        const listView = document.getElementById('list-view');
        const gridView = document.getElementById('grid-view');
        const listBtn = document.getElementById('list-view-btn');
        const gridBtn = document.getElementById('grid-view-btn');
        const sortControls = document.querySelector('.sort-controls');
        
        if (viewType === 'grid') {
            listView.style.display = 'none';
            gridView.style.display = 'flex';
            listBtn.classList.remove('active');
            gridBtn.classList.add('active');
            sortControls.style.display = 'flex';
        } else {
            listView.style.display = 'block';
            gridView.style.display = 'none';
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
            sortControls.style.display = 'none';
        }
        
        // Save preference
        localStorage.setItem('photoViewPreference', viewType);
    }
    
    // Function to change the number of rows per page
    function changeRowsPerPage(perPage) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('per_page', perPage);
        currentUrl.searchParams.set('page', '1'); // Reset to first page when changing rows per page
        window.location.href = currentUrl.toString();
    }
    
    // Filtering functionality
    function initializeFilters() {
        // Close all filter dropdowns initially
        document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
            dropdown.style.display = 'none';
        });
        
        // Handle special case for "all" checkbox in status filter
        const allStatusCheckbox = document.querySelector('input[name="status_filter"][value="all"]');
        const otherStatusCheckboxes = document.querySelectorAll('input[name="status_filter"]:not([value="all"])');
        
        if (allStatusCheckbox) {
            allStatusCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    otherStatusCheckboxes.forEach(cb => {
                        cb.checked = false;
                    });
                }
            });
            
            otherStatusCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        allStatusCheckbox.checked = false;
                    } else if (!document.querySelector('input[name="status_filter"]:not([value="all"]):checked')) {
                        // If no other checkboxes are checked, check the "all" checkbox
                        allStatusCheckbox.checked = true;
                    }
                });
            });
        }
    }
    
    function toggleFilter(filterId) {
        const filterElement = document.getElementById(filterId);
        document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
            if (dropdown.id !== filterId) {
                dropdown.style.display = 'none';
            }
        });
        
        if (filterElement.style.display === 'block') {
            filterElement.style.display = 'none';
        } else {
            filterElement.style.display = 'block';
        }
        
        // Close filter dropdown when clicking outside
        document.addEventListener('click', function closeDropdown(e) {
            if (!e.target.closest('.filter-dropdown') && !e.target.closest('.filter-toggle')) {
                filterElement.style.display = 'none';
                document.removeEventListener('click', closeDropdown);
            }
        });
    }
    
    function clearStatusFilter() {
        // Check the "all" checkbox and uncheck others
        const allCheckbox = document.querySelector('input[name="status_filter"][value="all"]');
        if (allCheckbox) {
            allCheckbox.checked = true;
        }
        
        const otherCheckboxes = document.querySelectorAll('input[name="status_filter"]:not([value="all"])');
        otherCheckboxes.forEach(cb => {
            cb.checked = false;
        });
        
        // Submit the form
        document.getElementById('status-filter-form').submit();
    }
    
    function clearCaptureDateFilter() {
        const form = document.getElementById('capture-date-filter-form');
        const captureFromInput = form.querySelector('input[name="capture_date_from"]');
        const captureToInput = form.querySelector('input[name="capture_date_to"]');
        
        captureFromInput.value = '';
        captureToInput.value = '';
        
        form.submit();
    }
    
    function clearUploadDateFilter() {
        const form = document.getElementById('upload-date-filter-form');
        const uploadFromInput = form.querySelector('input[name="upload_date_from"]');
        const uploadToInput = form.querySelector('input[name="upload_date_to"]');
        
        uploadFromInput.value = '';
        uploadToInput.value = '';
        
        form.submit();
    }
    
    function clearPlacesFilter() {
        const form = document.getElementById('places-filter-form');
        const placesInput = form.querySelector('input[name="places_filter"]');
        
        placesInput.value = '';
        
        form.submit();
    }

    // Function to update sort
    function updateSort(sortBy) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('sort_by', sortBy);
        currentUrl.searchParams.set('page', '1'); // Reset to first page when changing sort
        window.location.href = currentUrl.toString();
    }

    // Function to toggle sort direction
    function toggleSortDirection() {
        const sortDirectionBtn = document.getElementById('sort-direction-btn');
        const currentSortOrder = sortDirectionBtn.getAttribute('data-sort-order');
        const newSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('sort_order', newSortOrder);
        currentUrl.searchParams.set('page', '1'); // Reset to first page when changing sort direction
        window.location.href = currentUrl.toString();
    }
</script>
{% endblock %}